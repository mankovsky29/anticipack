@page "/donate"
@using Anticipack.Components.Shared.NavigationHeaderComponent
@inject INavigationHeaderService NavigationHeaderService
@inject IStringLocalizer<AppResources> L

<div class="donate-page">
    <div class="donate-header">
        <h1>@L["DonateTitle"]</h1>
        <p class="donate-description">@L["DonateDescription"]</p>
    </div>

    <div class="donate-options">
        <h2>@L["SelectAmount"]</h2>
        
        <div class="amount-buttons">
            <button class="amount-option @GetActiveClass(1)" @onclick="() => SelectAmount(1)">
                <span class="amount-value">$1</span>
            </button>
            
            <button class="amount-option @GetActiveClass(3)" @onclick="() => SelectAmount(3)">
                <span class="amount-value">$3</span>
            </button>
            
            <button class="amount-option @GetActiveClass(5)" @onclick="() => SelectAmount(5)">
                <span class="amount-value">$5</span>
            </button>
        </div>

        <div class="custom-amount">
            <label for="customAmount">@L["CustomAmount"]</label>
            <div class="input-group">
                <span class="currency-symbol">$</span>
                <input 
                    id="customAmount"
                    type="number" 
                    min="1" 
                    step="0.01" 
                    @bind="customAmount"
                    @bind:event="oninput"
                    @onfocus="OnCustomAmountFocus"
                    placeholder="0.00"
                    class="custom-amount-input" />
            </div>
        </div>

        <button class="donate-submit-button" 
                @onclick="ProcessDonation"
                disabled="@(!IsAmountValid())">
            @L["DonateNow"] @GetDisplayAmount()
        </button>
    </div>

    <div class="donate-footer">
        <p>@L["DonateThankYou"]</p>
    </div>
</div>

@code {
    private decimal? selectedAmount = null;
    private decimal? customAmount = null;

    protected override void OnInitialized()
    {
        NavigationHeaderService.SetText(L["Donate"]);
    }

    private void SelectAmount(decimal amount)
    {
        selectedAmount = amount;
        customAmount = null;
    }

    private void OnCustomAmountFocus()
    {
        selectedAmount = null;
    }

    private string GetActiveClass(decimal amount)
    {
        return selectedAmount == amount ? "active" : "";
    }

    private bool IsAmountValid()
    {
        if (selectedAmount.HasValue && selectedAmount.Value > 0)
            return true;
            
        if (customAmount.HasValue && customAmount.Value > 0)
            return true;
            
        return false;
    }

    private string GetDisplayAmount()
    {
        var amount = selectedAmount ?? customAmount ?? 0;
        return amount > 0 ? $"${amount:F2}" : "";
    }

    private async Task ProcessDonation()
    {
        var amount = selectedAmount ?? customAmount ?? 0;
        
        if (amount > 0)
        {
            // TODO: Implement actual donation processing logic
            // This could integrate with payment providers like Stripe, PayPal, etc.
            
            // For now, just show a placeholder message
            Console.WriteLine($"Processing donation of ${amount:F2}");
            
            // You might want to show a toast or dialog here
            // await ToastService.ShowSuccess($"Thank you for your ${amount:F2} donation!");
        }
    }
}
