@using Anticipack.Resources.Localization
@using Microsoft.Extensions.Logging
@inherits ErrorBoundary
@inject ILogger<CustomErrorBoundary> Logger

@if (CurrentException is not null)
{
    <div class="error-container">
        <h3>@AppResources.SomethingWentWrong</h3>
        <p>@CurrentException.Message</p>
        
        @* Show stack trace in debug mode *@
        @if (System.Diagnostics.Debugger.IsAttached)
        {
            <details style="margin-top: 1rem; color: #dc3545;">
                <summary style="cursor: pointer; font-weight: bold;">Stack Trace (Debug Only)</summary>
                <pre style="white-space: pre-wrap; font-size: 0.85rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; overflow-x: auto;">@CurrentException</pre>
            </details>
        }
        
        <button @onclick="Recover" style="margin-top: 1rem;">@AppResources.Retry</button>
    </div>
}
else
{
    @ChildContent
}

@code {
    protected override Task OnErrorAsync(Exception exception)
    {
        // Log the full exception details
        Logger.LogError(exception, "❌ UNHANDLED ERROR in component: {Message}", exception.Message);
        System.Diagnostics.Debug.WriteLine($"❌❌❌ ERROR CAUGHT BY ERROR BOUNDARY ❌❌❌");
        System.Diagnostics.Debug.WriteLine($"Exception Type: {exception.GetType().FullName}");
        System.Diagnostics.Debug.WriteLine($"Message: {exception.Message}");
        System.Diagnostics.Debug.WriteLine($"Stack Trace: {exception.StackTrace}");
        
        if (exception.InnerException != null)
        {
            System.Diagnostics.Debug.WriteLine($"Inner Exception: {exception.InnerException.Message}");
            System.Diagnostics.Debug.WriteLine($"Inner Stack Trace: {exception.InnerException.StackTrace}");
        }
        
        return base.OnErrorAsync(exception);
    }
}