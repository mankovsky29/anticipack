@using Anticipack.Components.Shared.SidebarTextComponent
@implements IDisposable
@inject ISidebarTextService SidebarTextService

@if (!_isNavMenuExpanded)
{
    <div class="sidebar-text-container">
        @if (!string.IsNullOrWhiteSpace(_displayText))
        {
            <div class="sidebar-text-display">
                <span class="sidebar-text">@_displayText</span>
            </div>
        }
    </div>
}

@code {
    private string _displayText = string.Empty;
    private string? _packingId;
    private bool _isNavMenuExpanded = false;

    protected override void OnInitialized()
    {
        // Subscribe to service events
        if (SidebarTextService is SidebarTextService service)
        {
            service.OnTextChanged += UpdateText;
            service.OnPackingIdChanged += UpdatePackingId;
            service.OnNavMenuToggled += UpdateNavMenuState;
            
            // Initialize with current values
            _displayText = service.GetText();
            _packingId = service.GetPackingId();
            _isNavMenuExpanded = service.IsNavMenuExpanded();
        }
    }

    private void UpdateText(string text)
    {
        _displayText = text;
        InvokeAsync(StateHasChanged);
    }

    private void UpdatePackingId(string? packingId)
    {
        _packingId = packingId;
        InvokeAsync(StateHasChanged);
    }

    private void UpdateNavMenuState(bool isExpanded)
    {
        _isNavMenuExpanded = isExpanded;
        InvokeAsync(StateHasChanged);
    }

    void IDisposable.Dispose()
    {
        // Unsubscribe from events
        if (SidebarTextService is SidebarTextService service)
        {
            service.OnTextChanged -= UpdateText;
            service.OnPackingIdChanged -= UpdatePackingId;
            service.OnNavMenuToggled -= UpdateNavMenuState;
        }
    }
}
